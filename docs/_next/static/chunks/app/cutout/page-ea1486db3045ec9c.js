(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[810],{3339:function(e,t,a){Promise.resolve().then(a.bind(a,1610))},1610:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return o}});var s=a(3827),l=a(4090);let r=["image/png","image/jpeg","image/jpg","image/webp"],n="rounded-3xl border border-white/60 bg-white/80 p-8 shadow-[0_28px_60px_-30px_rgba(30,41,59,0.45)] backdrop-blur-xl",i="rounded-2xl border border-white/70 bg-white/60 p-4 backdrop-blur",c="inline-flex items-center justify-center rounded-full bg-[#007AFF] px-6 py-3 text-base font-semibold text-white shadow-[0_24px_40px_-20px_rgba(0,122,255,0.65)] transition hover:bg-[#0066d6] active:bg-[#0054ad] focus:outline-none focus:ring-4 focus:ring-[#007AFF]/40 disabled:cursor-not-allowed disabled:bg-[#9CC8FF] disabled:shadow-none";async function d(e){let t=URL.createObjectURL(e);try{let e=await new Promise((e,a)=>{let s=new Image;s.onload=()=>e(s),s.onerror=a,s.src=t});return{width:e.naturalWidth,height:e.naturalHeight}}finally{URL.revokeObjectURL(t)}}function o(){let[e,t]=(0,l.useState)(null),[a,o]=(0,l.useState)(null),[x,h]=(0,l.useState)(30),[u,m]=(0,l.useState)(0),[g,p]=(0,l.useState)(null),[b,f]=(0,l.useState)("image/png"),[j,w]=(0,l.useState)(!1),[v,N]=(0,l.useState)(null),y=(0,l.useRef)(null);(0,l.useEffect)(()=>()=>{e&&URL.revokeObjectURL(e.previewUrl),g&&URL.revokeObjectURL(g)},[g,e]);let F=(0,l.useCallback)(async a=>{if(!a||0===a.length)return;let s=a[0];if(!r.includes(s.type)){N("请上传 PNG / JPG / WebP 图片。");return}let l=await d(s);e&&URL.revokeObjectURL(e.previewUrl),g&&URL.revokeObjectURL(g),t({file:s,previewUrl:URL.createObjectURL(s),width:l.width,height:l.height}),o(null),p(null),N(null)},[g,e]);(0,l.useEffect)(()=>{if(!e||!y.current)return;let t=y.current;t.width=e.width,t.height=e.height;let a=t.getContext("2d");a&&createImageBitmap(e.file).then(e=>{a.clearRect(0,0,t.width,t.height),a.drawImage(e,0,0,t.width,t.height)})},[e]);let U=(0,l.useCallback)(t=>{if(!y.current||!e)return;let a=y.current,s=a.getBoundingClientRect(),l=a.width/s.width,r=a.height/s.height,n=Math.floor((t.clientX-s.left)*l),i=Math.floor((t.clientY-s.top)*r),c=a.getContext("2d");if(!c)return;let d=c.getImageData(n,i,1,1).data;o({r:d[0],g:d[1],b:d[2]})},[e]),R=(0,l.useCallback)(async()=>{if(!e){N("请先上传图片。");return}if(!a){N("点击预览选择要抠除的背景颜色。");return}w(!0),N(null);try{let t=await createImageBitmap(e.file),s=document.createElement("canvas");s.width=Math.round(e.width),s.height=Math.round(e.height);let l=s.getContext("2d");if(!l)throw Error("未能创建绘图上下文");l.drawImage(t,0,0,s.width,s.height);let r=l.getImageData(0,0,s.width,s.height),n=r.data;for(let e=0;e<n.length;e+=4){let t=n[e],s=n[e+1],l=n[e+2],r=function(e,t){let a=e.r-t.r,s=e.g-t.g,l=e.b-t.b;return Math.sqrt(a*a+s*s+l*l)}({r:t,g:s,b:l},a);if(r<=x){let t=0;u>0&&(t=Math.max(0,r/Math.max(x,1)*255),t=Math.min(t,255)),n[e+3]=t}}l.putImageData(r,0,0);let i=s.toDataURL(b,"image/png"===b?void 0:.92);g&&URL.revokeObjectURL(g),p(i)}catch(e){console.error(e),N("抠图过程中出现问题，请尝试调整容差或换用更清晰的图片背景。")}finally{w(!1)}},[u,b,g,a,e,x]),k=(0,l.useCallback)(()=>{e&&URL.revokeObjectURL(e.previewUrl),g&&URL.revokeObjectURL(g),t(null),o(null),p(null),N(null)},[g,e]),_=(0,l.useMemo)(()=>a?{backgroundColor:"rgb(".concat(a.r,", ").concat(a.g,", ").concat(a.b,")")}:{backgroundColor:"transparent"},[a]);return(0,s.jsxs)("section",{className:"space-y-8",children:[(0,s.jsxs)("div",{className:"".concat(n," space-y-6"),children:[(0,s.jsx)("div",{className:"space-y-2",children:(0,s.jsxs)("label",{onDragOver:e=>e.preventDefault(),onDrop:e=>{e.preventDefault(),F(e.dataTransfer.files)},className:"flex cursor-pointer flex-col items-center justify-center gap-3 rounded-2xl border border-dashed border-slate-300 bg-white/60 px-6 py-10 text-center transition hover:border-[#007AFF]/40 hover:bg-[#F3F6FF]",children:[(0,s.jsx)("span",{className:"rounded-full bg-[#007AFF]/10 px-4 py-1 text-xs font-medium text-[#0A84FF]",children:"拖拽或点击上传"}),(0,s.jsx)("p",{className:"text-lg font-medium text-slate-700",children:"选择需要抠图的图片"}),(0,s.jsx)("p",{className:"text-sm text-slate-500",children:"建议使用背景较纯净的图片，点击预览可选取背景颜色。"}),(0,s.jsx)("input",{type:"file",accept:r.join(","),className:"hidden",onChange:e=>F(e.target.files)})]})}),e&&(0,s.jsxs)("div",{className:"".concat(i," space-y-4"),children:[(0,s.jsxs)("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-semibold text-slate-700",children:"点击下方预览选择背景颜色"}),(0,s.jsx)("p",{className:"text-xs text-slate-500",children:"系统将把与所选颜色相近的区域转为透明，可通过容差微调范围。"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 rounded-2xl border border-white/70 bg-white/70 px-3 py-2 text-xs text-slate-500",children:[(0,s.jsx)("span",{children:"当前颜色:"}),(0,s.jsx)("span",{className:"h-5 w-5 rounded-full border",style:_})]}),(0,s.jsx)("div",{className:"space-y-1 text-xs text-slate-500",children:(0,s.jsxs)("p",{children:["图片尺寸：",e.width," \xd7 ",e.height," px"]})})]})]}),(0,s.jsx)("div",{className:"overflow-hidden rounded-2xl border border-white/60 bg-white/70 p-3",children:(0,s.jsx)("canvas",{ref:y,className:"w-full cursor-crosshair",onClick:U,style:{maxHeight:"540px"}})}),(0,s.jsx)("p",{className:"text-xs text-slate-400",children:"提示：点击不同区域可重新选择背景颜色，生成前请确保主体边缘清晰。"})]}),e&&(0,s.jsxs)("div",{className:"".concat(i," grid gap-4 md:grid-cols-2"),children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("label",{className:"text-sm font-semibold text-slate-700",children:["容差 (",x,")"]}),(0,s.jsx)("input",{type:"range",min:5,max:120,step:5,value:x,onChange:e=>h(Number(e.target.value)),className:"w-full accent-[#007AFF]"}),(0,s.jsx)("p",{className:"text-xs text-slate-500",children:"容差越高，抠图影响的背景范围越大，适合渐变或阴影背景。"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("label",{className:"text-sm font-semibold text-slate-700",children:["羽化 (",u,"px)"]}),(0,s.jsx)("input",{type:"range",min:0,max:60,step:5,value:u,onChange:e=>m(Number(e.target.value)),className:"w-full accent-[#007AFF]"}),(0,s.jsx)("p",{className:"text-xs text-slate-500",children:"适当羽化可柔化边缘，减少锯齿感。"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"text-sm font-semibold text-slate-700",children:"输出格式"}),(0,s.jsxs)("select",{className:"w-full rounded-2xl border border-slate-200 bg-white/70 px-4 py-3 text-sm text-slate-900 placeholder:text-slate-400 shadow-inner focus:border-[#007AFF] focus:outline-none focus:ring-2 focus:ring-[#007AFF]/40",value:b,onChange:e=>f(e.target.value),children:[(0,s.jsx)("option",{value:"image/png",children:"PNG（透明背景）"}),(0,s.jsx)("option",{value:"image/webp",children:"WebP（现代格式）"})]})]})]}),v&&(0,s.jsx)("div",{className:"rounded-2xl border border-red-200/70 bg-red-50/80 px-4 py-3 text-sm text-red-700",children:v}),(0,s.jsxs)("div",{className:"flex flex-wrap items-center justify-end gap-3",children:[(0,s.jsx)("button",{type:"button",className:"inline-flex items-center justify-center rounded-full border border-slate-200/80 bg-white/70 px-5 py-3 text-sm font-medium text-slate-600 transition hover:border-[#007AFF]/60 hover:text-[#007AFF] focus:outline-none focus:ring-4 focus:ring-[#007AFF]/30 disabled:opacity-60",onClick:k,disabled:j,children:"清空"}),(0,s.jsx)("button",{type:"button",className:c,onClick:R,disabled:j||!e,children:j?"处理中…":"生成抠图结果"})]})]}),g&&(0,s.jsxs)("div",{className:"".concat(n," space-y-6"),children:[(0,s.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:"抠图预览 & 下载"}),(0,s.jsx)("a",{href:g,download:"cutout.".concat("image/png"===b?"png":"webp"),className:c,children:"下载透明图"})]}),(0,s.jsx)("p",{className:"text-sm text-slate-500",children:"如需更精准的抠图，可多次点击不同背景区域或调整容差。"}),(0,s.jsx)("div",{className:"mt-4 flex flex-col gap-6 lg:flex-row",children:(0,s.jsxs)("div",{className:"flex-1 rounded-2xl border border-white/60 bg-white/70 p-4",children:[(0,s.jsx)("p",{className:"text-sm font-semibold text-slate-700",children:"透明背景预览"}),(0,s.jsx)("div",{className:"mt-3 grid place-items-center rounded-xl bg-[linear-gradient(45deg,#e5e7eb_25%,transparent_25%),linear-gradient(-45deg,#e5e7eb_25%,transparent_25%),linear-gradient(45deg,transparent_75%,#e5e7eb_75%),linear-gradient(-45deg,transparent_75%,#e5e7eb_75%)] bg-[length:20px_20px]",children:(0,s.jsx)("img",{src:g,alt:"抠图结果",className:"w-full max-w-full rounded-xl"})})]})})]})]})}}},function(e){e.O(0,[971,69,744],function(){return e(e.s=3339)}),_N_E=e.O()}]);