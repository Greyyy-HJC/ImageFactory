(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[112],{5777:function(e,t,l){Promise.resolve().then(l.bind(l,6693))},6693:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return o}});var a=l(3827),s=l(4090);let r=["image/png","image/jpeg","image/jpg"],n="rounded-3xl border border-white/60 bg-white/80 p-8 shadow-[0_28px_60px_-30px_rgba(30,41,59,0.45)] backdrop-blur-xl",i="rounded-2xl border border-white/70 bg-white/60 p-4 backdrop-blur",c="inline-flex items-center justify-center rounded-full bg-[#007AFF] px-6 py-3 text-base font-semibold text-white shadow-[0_24px_40px_-20px_rgba(0,122,255,0.65)] transition hover:bg-[#0066d6] active:bg-[#0054ad] focus:outline-none focus:ring-4 focus:ring-[#007AFF]/40 disabled:cursor-not-allowed disabled:bg-[#9CC8FF] disabled:shadow-none";async function d(e){let t=URL.createObjectURL(e);try{let e=await new Promise((e,l)=>{let a=new Image;a.onload=()=>e(a),a.onerror=l,a.src=t});return{width:e.naturalWidth,height:e.naturalHeight}}finally{URL.revokeObjectURL(t)}}function o(){let[e,t]=(0,s.useState)([]),[l,o]=(0,s.useState)("image/png"),[h,u]=(0,s.useState)(.9),[x,m]=(0,s.useState)(null),[p,f]=(0,s.useState)(!1),[g,b]=(0,s.useState)(null),[j,w]=(0,s.useState)(null);(0,s.useEffect)(()=>()=>{e.forEach(e=>URL.revokeObjectURL(e.previewUrl))},[e]);let v=(0,s.useCallback)(async e=>{if(!e||0===e.length)return;let l=Array.from(e).filter(e=>r.includes(e.type));if(0===l.length){b("请上传 PNG 或 JPG 图片。");return}b(null);let a=await Promise.all(l.map(async e=>{let t=await d(e);return{file:e,previewUrl:URL.createObjectURL(e),width:t.width,height:t.height}}));t(e=>(e.forEach(e=>URL.revokeObjectURL(e.previewUrl)),a)),m(null)},[]),N=(0,s.useCallback)(e=>()=>{w(e)},[]),y=(0,s.useCallback)(e=>l=>{l.preventDefault(),null!==j&&j!==e&&(t(t=>{let l=[...t],[a]=l.splice(j,1);return l.splice(e,0,a),l}),w(e))},[j]),F=(0,s.useCallback)(()=>{w(null)},[]),k=(0,s.useMemo)(()=>{if(0===e.length)return null;let t=Math.max(...e.map(e=>e.width)),l=e.reduce((e,l)=>e+Math.round(t*l.height/l.width),0);return{baseWidth:t,totalHeight:l}},[e]),U=(0,s.useCallback)(async()=>{if(0===e.length){b("请先上传至少一张图片。");return}f(!0),b(null);try{let t=Math.max(...e.map(e=>e.width)),a=document.createElement("canvas"),s=[];for(let l of e){let e=Math.round(t*l.height/l.width);s.push(e)}let r=s.reduce((e,t)=>e+t,0);a.width=t,a.height=r;let n=a.getContext("2d");if(!n)throw Error("未能创建绘图上下文。");n.fillStyle="#ffffff",n.fillRect(0,0,a.width,a.height);let i=0;for(let l=0;l<e.length;l+=1){let a=e[l],r=s[l],c=await createImageBitmap(a.file);n.drawImage(c,0,i,t,r),i+=r}let c=a.toDataURL(l,"image/png"===l?void 0:h);m(c)}catch(e){console.error(e),b("拼接过程中出现问题，请重试。")}finally{f(!1)}},[e,h,l]),C=(0,s.useCallback)(()=>{e.forEach(e=>URL.revokeObjectURL(e.previewUrl)),t([]),m(null),b(null)},[e]);return(0,a.jsxs)("section",{className:"space-y-8",children:[(0,a.jsxs)("div",{className:"".concat(n," space-y-6"),children:[(0,a.jsx)("div",{className:"space-y-2",children:(0,a.jsxs)("label",{onDragOver:e=>e.preventDefault(),onDrop:e=>{e.preventDefault(),v(e.dataTransfer.files)},className:"flex cursor-pointer flex-col items-center justify-center gap-3 rounded-2xl border border-dashed border-slate-300 bg-white/60 px-6 py-10 text-center transition hover:border-[#007AFF]/40 hover:bg-[#F3F6FF]",children:[(0,a.jsx)("span",{className:"rounded-full bg-[#007AFF]/10 px-4 py-1 text-xs font-medium text-[#0A84FF]",children:"拖拽或点击上传"}),(0,a.jsx)("p",{className:"text-lg font-medium text-slate-700",children:"选择照片"}),(0,a.jsx)("p",{className:"text-sm text-slate-500",children:"上传 PNG 或 JPG 图片，系统会自动统一宽度。"}),(0,a.jsx)("input",{type:"file",accept:r.join(","),multiple:!0,className:"hidden",onChange:e=>v(e.target.files)})]})}),e.length>0&&(0,a.jsxs)("div",{className:"".concat(i," space-y-4"),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-sm font-semibold uppercase tracking-[0.3em] text-slate-400",children:"图片顺序"}),(0,a.jsx)("p",{className:"text-xs text-slate-500",children:"拖拽卡片可调整位置"})]}),(0,a.jsx)("div",{className:"space-y-3",children:e.map((e,t)=>(0,a.jsxs)("div",{draggable:!0,onDragStart:N(t),onDragOver:y(t),onDragEnd:F,className:"flex cursor-grab items-center gap-4 rounded-2xl border border-white/70 bg-white/80 p-3 shadow-sm transition ".concat(j===t?"ring-2 ring-[#0A84FF]/60":""),children:[(0,a.jsx)("img",{src:e.previewUrl,alt:e.file.name,className:"h-14 w-14 rounded-2xl object-cover shadow-md"}),(0,a.jsxs)("div",{className:"flex flex-1 flex-col text-sm text-slate-600",children:[(0,a.jsx)("span",{className:"truncate font-medium text-slate-700",title:e.file.name,children:e.file.name}),(0,a.jsxs)("span",{children:[e.width," \xd7 ",e.height," px \xb7 ",(e.file.size/1024).toFixed(1)," KB"]})]}),(0,a.jsx)("span",{className:"text-xs font-medium text-slate-400",children:"拖动"})]},e.file.name))})]}),(0,a.jsxs)("div",{className:"".concat(i," space-y-4"),children:[(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-semibold text-slate-700",children:"输出格式"}),(0,a.jsxs)("select",{className:"w-full rounded-2xl border border-slate-200 bg-white/70 px-4 py-3 text-sm text-slate-900 placeholder:text-slate-400 shadow-inner focus:border-[#007AFF] focus:outline-none focus:ring-2 focus:ring-[#007AFF]/40",value:l,onChange:e=>o(e.target.value),children:[(0,a.jsx)("option",{value:"image/png",children:"PNG（无损）"}),(0,a.jsx)("option",{value:"image/jpeg",children:"JPG（可调质量）"})]})]}),"image/jpeg"===l&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("label",{className:"text-sm font-semibold text-slate-700",children:["JPG 质量 (",Math.round(100*h),"%)"]}),(0,a.jsx)("input",{type:"range",min:.4,max:1,step:.05,value:h,onChange:e=>u(Number(e.target.value)),className:"w-full accent-[#007AFF]"})]})]}),k&&(0,a.jsxs)("div",{className:"rounded-2xl border border-white/70 bg-white/70 p-4 text-xs text-slate-500",children:["预计尺寸：宽 ",k.baseWidth,"px \xb7 高 ",k.totalHeight,"px"]})]}),g&&(0,a.jsx)("div",{className:"rounded-2xl border border-red-200/70 bg-red-50/80 px-4 py-3 text-sm text-red-700",children:g}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center justify-end gap-3",children:[(0,a.jsx)("button",{type:"button",className:"inline-flex items-center justify-center rounded-full border border-slate-200/80 bg-white/70 px-5 py-3 text-sm font-medium text-slate-600 transition hover:border-[#007AFF]/60 hover:text-[#007AFF] focus:outline-none focus:ring-4 focus:ring-[#007AFF]/30 disabled:opacity-60",onClick:C,disabled:p||0===e.length,children:"清空"}),(0,a.jsx)("button",{type:"button",className:c,onClick:U,disabled:p||0===e.length,children:p?"生成中…":"生成长图"})]})]}),x&&(0,a.jsxs)("div",{className:n,children:[(0,a.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:"拼接结果预览"}),(0,a.jsx)("a",{href:x,download:"photocollage.".concat("image/png"===l?"png":"jpg"),className:c,children:"下载拼图"})]}),(0,a.jsx)("p",{className:"mt-2 text-sm text-slate-500",children:"如长图过高，请在下载后使用系统相册或图片查看器查看完整效果。"}),(0,a.jsx)("div",{className:"mt-6 max-h-[600px] overflow-auto rounded-2xl border border-white/60 bg-white/70 p-4",children:(0,a.jsx)("img",{src:x,alt:"拼图结果预览",className:"mx-auto w-full"})})]})]})}}},function(e){e.O(0,[971,69,744],function(){return e(e.s=5777)}),_N_E=e.O()}]);