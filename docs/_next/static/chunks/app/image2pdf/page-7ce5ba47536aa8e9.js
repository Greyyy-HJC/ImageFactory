(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[95],{6620:function(e,t,a){Promise.resolve().then(a.bind(a,1055))},1055:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return p}});var l=a(3827),s=a(4090),i=a(5842);let r="rounded-3xl border border-white/60 bg-white/80 p-8 shadow-[0_28px_60px_-30px_rgba(30,41,59,0.45)] backdrop-blur-xl",n="rounded-2xl border border-white/70 bg-white/60 p-4 backdrop-blur",c="w-full rounded-2xl border border-slate-200 bg-white/70 px-4 py-3 text-sm text-slate-900 placeholder:text-slate-400 shadow-inner focus:border-[#007AFF] focus:outline-none focus:ring-2 focus:ring-[#007AFF]/40",d="inline-flex items-center justify-center rounded-full bg-[#007AFF] px-6 py-3 text-base font-semibold text-white shadow-[0_24px_40px_-20px_rgba(0,122,255,0.65)] transition hover:bg-[#0066d6] active:bg-[#0054ad] focus:outline-none focus:ring-4 focus:ring-[#007AFF]/40 disabled:cursor-not-allowed disabled:bg-[#9CC8FF] disabled:shadow-none",o=["image/png","image/jpeg","image/jpg","application/pdf"],u=[{label:"不限制",value:0},{label:"≤ 500 KB",value:512e3},{label:"≤ 1 MB",value:1048576},{label:"≤ 2 MB",value:2097152},{label:"≤ 5 MB",value:5242880}],x={source:{label:"保持原始尺寸",size:null},"a4-portrait":{label:"A4 竖版",size:{width:595.28,height:841.89}},"a4-landscape":{label:"A4 横版",size:{width:841.89,height:595.28}}};async function h(e){let t=URL.createObjectURL(e);try{let e=await new Promise((e,a)=>{let l=new Image;l.onload=()=>e(l),l.onerror=a,l.src=t});return{width:e.naturalWidth,height:e.naturalHeight}}finally{URL.revokeObjectURL(t)}}async function m(e){let t=await e.arrayBuffer(),a=await i.PDFDocument.load(t);return{arrayBuffer:t,pageCount:a.getPageCount()}}function p(){let[e,t]=(0,s.useState)([]),[a,p]=(0,s.useState)(1),[f,b]=(0,s.useState)(u[0].value),[g,w]=(0,s.useState)("source"),[j,v]=(0,s.useState)(null),[y,F]=(0,s.useState)(null),[N,U]=(0,s.useState)(!1),[k,P]=(0,s.useState)(null);(0,s.useEffect)(()=>()=>{t(e=>(e.forEach(e=>{e.previewUrl&&URL.revokeObjectURL(e.previewUrl)}),[])),j&&URL.revokeObjectURL(j)},[j]);let C=(0,s.useCallback)(async e=>{if(!e||0===e.length)return;let a=Array.from(e).filter(e=>o.includes(e.type));if(0===a.length){P("请选择 PNG、JPG 或 PDF 文件。");return}P(null);let l=[];for(let e of a)if("application/pdf"===e.type)try{let t=await m(e);l.push({kind:"pdf",file:e,previewUrl:null,pageCount:t.pageCount})}catch(e){console.error(e),P("无法解析部分 PDF 文件，请确认格式是否正确。")}else{let t=await h(e);l.push({kind:"image",file:e,previewUrl:URL.createObjectURL(e),dimensions:t})}t(e=>(e.forEach(e=>e.previewUrl&&URL.revokeObjectURL(e.previewUrl)),l)),v(null),F(null)},[]),L=(0,s.useCallback)(async e=>{e.preventDefault(),await C(e.dataTransfer.files)},[C]),D=(0,s.useMemo)(()=>1===a?"原始尺寸 (100%)":a>1?"放大 ".concat((100*a).toFixed(0),"%"):"缩小 ".concat((100*a).toFixed(0),"%"),[a]),R=(0,s.useMemo)(()=>e.some(e=>"image"===e.kind),[e]),A=(0,s.useCallback)(async t=>{let a=await i.PDFDocument.create();for(let l of e)if("image"===l.kind){let e=await l.file.arrayBuffer(),s="image/png"===l.file.type?await a.embedPng(e):await a.embedJpg(e),i=l.dimensions,r=i.width*t,n=i.height*t,c=x[g].size;if(c){let e=a.addPage([c.width,c.height]),t=Math.min(c.width/r,c.height/n),l=r*t,i=n*t,d=(c.width-l)/2,o=(c.height-i)/2;e.drawImage(s,{x:d,y:o,width:l,height:i})}else a.addPage([r,n]).drawImage(s,{x:0,y:0,width:r,height:n})}else{let e=await l.file.arrayBuffer(),t=await i.PDFDocument.load(e),s=t.getPageIndices();(await a.copyPages(t,s)).forEach(e=>a.addPage(e))}return{bytes:await a.save(),usedScale:t}},[e,g]),_=(0,s.useCallback)(async()=>{if(0===e.length){P("请先上传至少一个文件。");return}U(!0),P(null),F(null);try{let e=a,t=await A(e),l=0;if(f>0&&t.bytes.length>f&&R)for(;l<6&&t.bytes.length>f&&e>.25;)e=Math.max(.25,.85*e),t=await A(e),l+=1;f>0&&t.bytes.length>f&&!R?F("当前文件包含的 PDF 页面无法压缩，请尝试精简内容。"):f>0&&t.bytes.length>f?F("已自动降低分辨率，但仍超过目标体积，请进一步压缩或拆分。"):f>0&&t.bytes.length<=f&&e!==a?F("已自动调整分辨率至 ".concat((100*e).toFixed(0),"% 以满足体积限制。")):F("生成成功，文件大小约 ".concat((t.bytes.length/1024).toFixed(1)," KB。"));let s=t.bytes.buffer.slice(t.bytes.byteOffset,t.bytes.byteOffset+t.bytes.byteLength),i=new Blob([s],{type:"application/pdf"});j&&URL.revokeObjectURL(j),v(URL.createObjectURL(i))}catch(e){console.error(e),P("转换过程中出现问题，请重试或尝试使用其他文件。")}finally{U(!1)}},[A,R,e.length,j,a,f]),O=(0,s.useCallback)(()=>{t(e=>(e.forEach(e=>e.previewUrl&&URL.revokeObjectURL(e.previewUrl)),[])),j&&URL.revokeObjectURL(j),v(null),F(null),P(null)},[j]);return(0,l.jsxs)("section",{className:"space-y-8",children:[(0,l.jsxs)("div",{className:"".concat(r," space-y-6"),children:[(0,l.jsx)("div",{className:"space-y-2",children:(0,l.jsxs)("label",{onDragOver:e=>e.preventDefault(),onDrop:L,className:"flex cursor-pointer flex-col items-center justify-center gap-3 rounded-2xl border border-dashed border-slate-300 bg-white/60 px-6 py-10 text-center transition hover:border-[#007AFF]/40 hover:bg-[#F3F6FF]",children:[(0,l.jsx)("span",{className:"rounded-full bg-[#007AFF]/10 px-4 py-1 text-xs font-medium text-[#0A84FF]",children:"拖拽或点击上传"}),(0,l.jsx)("p",{className:"text-lg font-medium text-slate-700",children:"选择图片或 PDF 文件"}),(0,l.jsx)("p",{className:"text-sm text-slate-500",children:"支持 PNG / JPG / PDF，可混合上传。"}),(0,l.jsx)("input",{type:"file",accept:o.join(","),multiple:!0,onChange:e=>C(e.target.files),className:"hidden"})]})}),e.length>0&&(0,l.jsxs)("div",{className:"".concat(n," space-y-4"),children:[(0,l.jsx)("h2",{className:"text-sm font-semibold uppercase tracking-[0.3em] text-slate-400",children:"已选择文件"}),(0,l.jsx)("div",{className:"grid gap-4 md:grid-cols-2",children:e.map(e=>{var t;return(0,l.jsxs)("figure",{className:"flex items-center gap-4 rounded-2xl border border-white/70 bg-white/80 p-3 shadow-sm",children:["image"===e.kind?(0,l.jsx)("img",{src:null!==(t=e.previewUrl)&&void 0!==t?t:"",alt:e.file.name,className:"h-16 w-16 rounded-2xl object-cover shadow-md"}):(0,l.jsx)("div",{className:"flex h-16 w-16 items-center justify-center rounded-2xl bg-[#007AFF]/10 text-sm font-semibold text-[#0A84FF]",children:"PDF"}),(0,l.jsxs)("figcaption",{className:"flex flex-1 flex-col gap-1 text-left text-sm text-slate-600",children:[(0,l.jsx)("span",{className:"truncate font-medium text-slate-700",title:e.file.name,children:e.file.name}),(0,l.jsxs)("span",{children:[(e.file.size/1024).toFixed(1)," KB \xb7 ","image"===e.kind?e.file.type.replace("image/","").toUpperCase():"".concat(e.pageCount," 页 PDF")]}),"image"===e.kind&&(0,l.jsxs)("span",{className:"text-xs text-slate-400",children:[e.dimensions.width," \xd7 ",e.dimensions.height," px"]})]})]},e.file.name)})})]}),(0,l.jsx)("div",{className:"".concat(n," space-y-4"),children:(0,l.jsxs)("div",{className:"grid gap-4 md:grid-cols-3",children:[(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"text-sm font-semibold text-slate-700",children:"分辨率调整"}),(0,l.jsxs)("div",{className:"flex items-center justify-between text-xs text-slate-500",children:[(0,l.jsx)("span",{children:"保持长宽比"}),(0,l.jsx)("span",{className:"text-[#0A84FF] font-medium",children:D})]}),(0,l.jsx)("input",{type:"range",min:.5,max:2,step:.1,value:a,onChange:e=>p(Number(e.target.value)),className:"w-full accent-[#007AFF]"})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"text-sm font-semibold text-slate-700",children:"目标体积"}),(0,l.jsx)("select",{className:c,value:f,onChange:e=>b(Number(e.target.value)),children:u.map(e=>(0,l.jsx)("option",{value:e.value,children:e.label},e.value))}),(0,l.jsx)("p",{className:"text-xs text-slate-500",children:"若超出限制，将自动尝试降低分辨率。"})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"text-sm font-semibold text-slate-700",children:"页面尺寸"}),(0,l.jsx)("select",{className:c,value:g,onChange:e=>w(e.target.value),children:Object.entries(x).map(e=>{let[t,a]=e;return(0,l.jsx)("option",{value:t,children:a.label},t)})}),(0,l.jsx)("p",{className:"text-xs text-slate-500",children:"保持原尺寸或统一到标准纸张大小。"})]})]})}),k&&(0,l.jsx)("div",{className:"rounded-2xl border border-red-200/70 bg-red-50/80 px-4 py-3 text-sm text-red-700",children:k}),y&&(0,l.jsx)("div",{className:"rounded-2xl border border-[#0A84FF]/20 bg-[#F0F6FF]/80 px-4 py-3 text-sm text-[#0A2463]",children:y}),(0,l.jsxs)("div",{className:"flex flex-wrap items-center justify-end gap-3",children:[(0,l.jsx)("button",{type:"button",className:"inline-flex items-center justify-center rounded-full border border-slate-200/80 bg-white/70 px-5 py-3 text-sm font-medium text-slate-600 transition hover:border-[#007AFF]/60 hover:text-[#007AFF] focus:outline-none focus:ring-4 focus:ring-[#007AFF]/30 disabled:opacity-60",onClick:O,disabled:N,children:"清空"}),(0,l.jsx)("button",{type:"button",className:d,onClick:_,disabled:N,children:N?"转换中…":"生成 PDF"})]})]}),j&&(0,l.jsxs)("div",{className:r,children:[(0,l.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[(0,l.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:"预览 & 下载"}),(0,l.jsx)("a",{href:j,download:"imagefactory-image2pdf.pdf",className:d,children:"下载 PDF"})]}),(0,l.jsx)("p",{className:"mt-2 text-sm text-slate-500",children:"预览为快速渲染，若出现模糊请直接下载查看最终效果。"}),(0,l.jsx)("div",{className:"mt-6 overflow-hidden rounded-2xl border border-white/60 bg-white/80 shadow-[0_28px_60px_-30px_rgba(30,41,59,0.45)]",children:(0,l.jsx)("iframe",{title:"生成的 PDF 预览",src:j,className:"h-[600px] w-full"})})]})]})}}},function(e){e.O(0,[842,971,69,744],function(){return e(e.s=6620)}),_N_E=e.O()}]);