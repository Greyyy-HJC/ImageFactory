(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[575],{2168:function(e,t,a){Promise.resolve().then(a.bind(a,6097))},6097:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return u}});var l=a(3827),r=a(4090);let n=["image/png","image/jpeg","image/jpg","image/webp"],s="rounded-3xl border border-white/60 bg-white/80 p-8 shadow-[0_28px_60px_-30px_rgba(30,41,59,0.45)] backdrop-blur-xl",i="rounded-2xl border border-white/70 bg-white/60 p-4 backdrop-blur",c="inline-flex items-center justify-center rounded-full bg-[#007AFF] px-6 py-3 text-base font-semibold text-white shadow-[0_24px_40px_-20px_rgba(0,122,255,0.65)] transition hover:bg-[#0066d6] active:bg-[#0054ad] focus:outline-none focus:ring-4 focus:ring-[#007AFF]/40 disabled:cursor-not-allowed disabled:bg-[#9CC8FF] disabled:shadow-none",o=[{id:"grayscale",name:"黑白",description:"经典黑白效果，突出光影层次。"},{id:"sketch",name:"素描",description:"模拟铅笔素描线条，突出轮廓。"},{id:"pixel",name:"像素",description:"低分辨率像素化风格，营造怀旧感。"},{id:"cartoon",name:"卡通",description:"降低色彩层次并增强边缘，形成卡通效果。"},{id:"ink",name:"国画",description:"淡化色彩并加入水墨感，呈现国风意境。"}];async function d(e){let t=URL.createObjectURL(e);try{let e=await new Promise((e,a)=>{let l=new Image;l.onload=()=>e(l),l.onerror=a,l.src=t});return{width:e.naturalWidth,height:e.naturalHeight}}finally{URL.revokeObjectURL(t)}}function h(e,t,a){return .299*e+.587*t+.114*a}function u(){let[e,t]=(0,r.useState)(null),[a,u]=(0,r.useState)(null),[m,x]=(0,r.useState)("grayscale"),[g,p]=(0,r.useState)(.7),[f,b]=(0,r.useState)("image/png"),[w,j]=(0,r.useState)(!1),[v,N]=(0,r.useState)(null),y=(0,r.useRef)(null);(0,r.useEffect)(()=>()=>{e&&URL.revokeObjectURL(e.previewUrl),a&&URL.revokeObjectURL(a)},[a,e]);let F=(0,r.useCallback)(async l=>{if(!l||0===l.length)return;let r=l[0];if(!n.includes(r.type)){N("请上传 PNG / JPG / WebP 图片。");return}let s=await d(r);e&&URL.revokeObjectURL(e.previewUrl),a&&URL.revokeObjectURL(a),t({file:r,previewUrl:URL.createObjectURL(r),width:s.width,height:s.height}),u(null),N(null)},[a,e]);(0,r.useEffect)(()=>{if(!e||!y.current)return;let t=y.current;t.width=e.width,t.height=e.height;let a=t.getContext("2d");a&&createImageBitmap(e.file).then(e=>{a.clearRect(0,0,t.width,t.height),a.drawImage(e,0,0,t.width,t.height)})},[e]);let k=(0,r.useCallback)(async()=>{if(!e){N("请先上传图片。");return}j(!0),N(null);try{let t=await createImageBitmap(e.file),l=document.createElement("canvas");l.width=e.width,l.height=e.height;let r=l.getContext("2d");if(!r)throw Error("未能创建绘图上下文");r.drawImage(t,0,0,l.width,l.height);let n=r.getImageData(0,0,l.width,l.height),s=function(e,t,a){let{width:l,height:r,data:n}=e,s=new Uint8ClampedArray(n);if("pixel"===t){let t=Math.max(4,Math.round((1-a)*40)),n=document.createElement("canvas");n.width=Math.max(1,Math.round(l/t)),n.height=Math.max(1,Math.round(r/t));let s=n.getContext("2d");if(!s)return e;let i=document.createElement("canvas");i.width=l,i.height=r;let c=i.getContext("2d");return c?(c.putImageData(e,0,0),s.imageSmoothingEnabled=!1,s.drawImage(i,0,0,n.width,n.height),c.imageSmoothingEnabled=!1,c.clearRect(0,0,l,r),c.drawImage(n,0,0,n.width,n.height,0,0,l,r),c.getImageData(0,0,l,r)):e}if("grayscale"===t){for(let e=0;e<s.length;e+=4){let t=h(s[e],s[e+1],s[e+2]);s[e]=s[e+1]=s[e+2]=t}return new ImageData(s,l,r)}if("sketch"===t||"cartoon"===t){let e=new Float32Array(l*r);for(let t=0,a=0;t<s.length;t+=4,a+=1)e[a]=h(s[t],s[t+1],s[t+2]);let n=[-1,0,1,-2,0,2,-1,0,1],i=[-1,-2,-1,0,0,0,1,2,1],c=new Float32Array(l*r),o=(t,a,n)=>{let s=0;for(let i=-1;i<=1;i+=1)for(let c=-1;c<=1;c+=1){let o=Math.min(l-1,Math.max(0,a+c));s+=e[Math.min(r-1,Math.max(0,n+i))*l+o]*t[(i+1)*3+(c+1)]}return s};for(let e=0;e<r;e+=1)for(let t=0;t<l;t+=1){let a=o(n,t,e),r=o(i,t,e);c[e*l+t]=Math.sqrt(a*a+r*r)}let d=0;for(let e=0;e<c.length;e+=1)c[e]>d&&(d=c[e]);for(let a=0,l=0;a<s.length;a+=4,l+=1){let r=c[l]/(d||1);if("sketch"===t){let e=255-255*Math.pow(r,.8);s[a]=s[a+1]=s[a+2]=e}else{let t=42.5*Math.round(e[l]/42.5),n=Math.pow(r,.8);s[a]=t*(1-n)+40*n,s[a+1]=t*(1-n)+40*n,s[a+2]=t*(1-n)+40*n}}if("cartoon"===t){let e=.35*a+.65;for(let t=0;t<s.length;t+=4)s[t]=Math.min(255,s[t]*e),s[t+1]=Math.min(255,s[t+1]*e*.98),s[t+2]=Math.min(255,s[t+2]*e*.94)}return new ImageData(s,l,r)}if("ink"===t)for(let e=0;e<s.length;e+=4){let t=h(s[e],s[e+1],s[e+2])*(.7+.3*a);s[e]=Math.min(255,1.05*t+12),s[e+1]=Math.min(255,.92*t+10),s[e+2]=Math.min(255,.85*t+18)}return new ImageData(s,l,r)}(n,m,g);r.putImageData(s,0,0);let i=l.toDataURL(f,"image/jpeg"===f?.92:void 0);a&&URL.revokeObjectURL(a),u(i)}catch(e){console.error(e),N("处理图片时出现问题，请尝试更换图片或降低强度。")}finally{j(!1)}},[g,f,a,e,m]),M=(0,r.useCallback)(()=>{e&&URL.revokeObjectURL(e.previewUrl),a&&URL.revokeObjectURL(a),t(null),u(null),N(null)},[a,e]),U=(0,r.useMemo)(()=>{switch(m){case"pixel":return"像素块大小 (".concat(Math.round((1-g)*40),"px)");case"cartoon":return"色彩强化 (".concat(Math.round(100*g),"%)");case"ink":return"晕染程度 (".concat(Math.round(100*g),"%)");case"sketch":return"线条细节 (".concat(Math.round(100*g),"%)");default:return"强度 (".concat(Math.round(100*g),"%)")}},[g,m]),R="grayscale"!==m;return(0,l.jsxs)("section",{className:"space-y-8",children:[(0,l.jsxs)("div",{className:"".concat(s," space-y-6"),children:[(0,l.jsx)("div",{className:"space-y-2",children:(0,l.jsxs)("label",{onDragOver:e=>e.preventDefault(),onDrop:e=>{e.preventDefault(),F(e.dataTransfer.files)},className:"flex cursor-pointer flex-col items-center justify-center gap-3 rounded-2xl border border-dashed border-slate-300 bg-white/60 px-6 py-10 text-center transition hover:border-[#007AFF]/40 hover:bg-[#F3F6FF]",children:[(0,l.jsx)("span",{className:"rounded-full bg-[#007AFF]/10 px-4 py-1 text-xs font-medium text-[#0A84FF]",children:"拖拽或点击上传"}),(0,l.jsx)("p",{className:"text-lg font-medium text-slate-700",children:"选择想要变换风格的图片"}),(0,l.jsx)("p",{className:"text-sm text-slate-500",children:"支持 PNG / JPG / WebP，可生成风格化的单张图片。"}),(0,l.jsx)("input",{type:"file",accept:n.join(","),className:"hidden",onChange:e=>F(e.target.files)})]})}),e&&(0,l.jsx)("div",{className:"".concat(i," space-y-4"),children:(0,l.jsx)("div",{className:"grid gap-3 md:grid-cols-2 lg:grid-cols-3",children:o.map(e=>{let t=m===e.id;return(0,l.jsxs)("button",{type:"button",onClick:()=>x(e.id),className:"flex flex-col items-start gap-2 rounded-2xl border px-4 py-3 text-left shadow-sm transition ".concat(t?"border-[#0A84FF]/60 bg-[#F0F6FF] text-[#0A2463]":"border-white/70 bg-white/70 text-slate-600 hover:border-[#0A84FF]/30"),children:[(0,l.jsx)("span",{className:"text-sm font-semibold",children:e.name}),(0,l.jsx)("span",{className:"text-xs text-slate-500",children:e.description})]},e.id)})})}),e&&(0,l.jsx)("div",{className:"".concat(i," space-y-4"),children:(0,l.jsxs)("div",{className:"flex flex-col gap-4 lg:flex-row",children:[(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("p",{className:"text-sm font-semibold text-slate-700",children:"原图预览"}),(0,l.jsx)("div",{className:"mt-3 overflow-hidden rounded-2xl border border-white/60 bg-white/70 p-3",children:(0,l.jsx)("canvas",{ref:y,className:"w-full",style:{maxHeight:"480px"}})})]}),a&&(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("p",{className:"text-sm font-semibold text-slate-700",children:"风格化预览"}),(0,l.jsx)("div",{className:"mt-3 overflow-hidden rounded-2xl border border-white/60 bg-white/70 p-3",children:(0,l.jsx)("img",{src:a,alt:"风格化结果",className:"w-full"})})]})]})}),e&&(0,l.jsxs)("div",{className:"".concat(i," grid gap-4 md:grid-cols-2"),children:[R&&(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"text-sm font-semibold text-slate-700",children:U}),(0,l.jsx)("input",{type:"range",min:.1,max:1,step:.05,value:g,onChange:e=>p(Number(e.target.value)),className:"w-full accent-[#007AFF]"})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"text-sm font-semibold text-slate-700",children:"输出格式"}),(0,l.jsxs)("select",{className:"w-full rounded-2xl border border-slate-200 bg-white/70 px-4 py-3 text-sm text-slate-900 placeholder:text-slate-400 shadow-inner focus:border-[#007AFF] focus:outline-none focus:ring-2 focus:ring-[#007AFF]/40",value:f,onChange:e=>b(e.target.value),children:[(0,l.jsx)("option",{value:"image/png",children:"PNG（透明背景）"}),(0,l.jsx)("option",{value:"image/jpeg",children:"JPG（高兼容性）"}),(0,l.jsx)("option",{value:"image/webp",children:"WebP（高压缩比）"})]})]})]}),v&&(0,l.jsx)("div",{className:"rounded-2xl border border-red-200/70 bg-red-50/80 px-4 py-3 text-sm text-red-700",children:v}),(0,l.jsxs)("div",{className:"flex flex-wrap items-center justify-end gap-3",children:[(0,l.jsx)("button",{type:"button",className:"inline-flex items-center justify-center rounded-full border border-slate-200/80 bg-white/70 px-5 py-3 text-sm font-medium text-slate-600 transition hover:border-[#007AFF]/60 hover:text-[#007AFF] focus:outline-none focus:ring-4 focus:ring-[#007AFF]/30 disabled:opacity-60",onClick:M,disabled:w,children:"清空"}),(0,l.jsx)("button",{type:"button",className:c,onClick:k,disabled:w||!e,children:w?"处理中…":"生成风格图"})]})]}),a&&(0,l.jsxs)("div",{className:"".concat(s," space-y-4"),children:[(0,l.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[(0,l.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:"下载结果"}),(0,l.jsx)("a",{href:a,download:"stylization-".concat(m,".").concat(f.split("/")[1]),className:c,children:"保存图片"})]}),(0,l.jsx)("p",{className:"text-sm text-slate-500",children:"提示：可重复尝试不同风格与强度，获得满意的视觉效果。"})]})]})}}},function(e){e.O(0,[971,69,744],function(){return e(e.s=2168)}),_N_E=e.O()}]);